<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç ‚Äî Nord –ß–µ–±</title>
  <link rel="stylesheet" href="style.css?v24">
  <meta name="robots" content="noindex, nofollow">
</head>
<body class="dark">
  <header>
    <img src="logo.png" alt="Nord –ß–µ–±" class="logo">
    <button id="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô / ‚òÄÔ∏è</button>
  </header>

  <main>
    <div class="container" id="guard" style="text-align:center;">
      <h2>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h2>
      <p class="calc-note">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É–∂–µ–±–Ω—É—é —Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.</p>
    </div>

    <div class="container hidden" id="calc-app">
      <h1 style="margin:0 0 8px;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç</h1>
      <div class="badge">–¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</div>

      <div class="section-title">–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</div>
      <table class="calc-table" id="table-main">
        <thead>
          <tr><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th><th>–ö–æ–ª-–≤–æ</th><th>–ï–¥. –∏–∑–º.</th><th>–¶–µ–Ω–∞ –µ–¥.</th><th>–¶–µ–Ω–∞</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</div>
      <table class="calc-table" id="table-extra">
        <thead>
          <tr><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th><th>–ö–æ–ª-–≤–æ</th><th>–ï–¥. –∏–∑–º.</th><th>–¶–µ–Ω–∞ –µ–¥.</th><th>–¶–µ–Ω–∞</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="total-line"><b>–ò—Ç–æ–≥–æ:</b> <span id="grand-total">0</span> ‚ÇΩ</div>

      
    </div>
  </main>

  <footer style="padding:16px;opacity:.7;font-size:12px; text-align:center;">
    –í–µ—Ä—Å–∏—è —Å–±–æ—Ä–∫–∏: v35 ‚Ä¢ 2025-09-15 19:04:57 (MSK)</footer>

  


<script>
function enhanceNumberInputs(scope=document){
  const isDigit = (k) => /^[0-9]$/.test(k);
  scope.querySelectorAll('input[type="number"]').forEach(inp => {
    const selectIfZeroOrEmpty = () => { if (inp.value === "" || inp.value === "0") { try { inp.select(); } catch(e){} } };
    inp.addEventListener('focus', selectIfZeroOrEmpty);
    inp.addEventListener('click', selectIfZeroOrEmpty);
    inp.addEventListener('keydown', (e) => { if ((inp.value === "" || inp.value === "0") && isDigit(e.key)) { inp.value = ""; } });
    inp.addEventListener('input', () => {
      if (inp.value === "") return;
      let n = String(inp.value).replace(/[^0-9]/g, "");
      if (n === "") { inp.value = ""; return; }
      inp.value = String(Math.max(0, parseInt(n, 10)));
    });
  });
}
try { enhanceNumberInputs(document); } catch(e){}

function parseMoney(text){ const d = String(text||'').replace(/[^\d]/g,''); return d?parseInt(d,10):0; }
function buildEstimate(){
  const rows = [];
  document.querySelectorAll('#table-main tbody tr, #table-extra tbody tr').forEach(tr => {
    const name = tr.querySelector('td:nth-child(1)')?.textContent.trim() || '';
    const qty  = parseInt(tr.querySelector('input')?.value || '0', 10) || 0;
    const unitPrice = parseMoney(tr.querySelector('.price')?.textContent);
    const sum  = parseMoney(tr.querySelector('.sum')?.textContent);
    if (qty > 0 && sum > 0) rows.push({name, qty, unitPrice, sum});
  });
  const wrap = document.getElementById('estimate-body');
  if (!wrap) return;
  if (!rows.length){
    wrap.innerHTML = '<p class="kicker">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ. –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á—ë—Ç¬ª.</p>';
    return;
  }
  let total = 0;
  const items = rows.map(r => { total += r.sum; return (
    `<tr>
      <td>${r.name}</td>
      <td style="text-align:center;">${r.qty}</td>
      <td style="white-space:nowrap;">${r.unitPrice.toLocaleString('ru-RU')} ‚ÇΩ</td>
      <td style="white-space:nowrap; text-align:right;"><b>${r.sum.toLocaleString('ru-RU')} ‚ÇΩ</b></td>
    </tr>`);
  }).join('');
  wrap.innerHTML = `
    <div class="kicker" style="margin-bottom:8px;">–ê–≤—Ç–æ—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç</div>
    <div style="overflow:auto;">
      <table class="calc-table">
        <thead><tr><th>–ü–æ–∑–∏—Ü–∏—è</th><th>–ö–æ–ª-–≤–æ</th><th>–¶–µ–Ω–∞ –µ–¥.</th><th>–°—É–º–º–∞</th></tr></thead>
        <tbody>${items}</tbody>
      </table>
    </div>
    <div class="total-line" style="margin-top:10px;"><b>–ò—Ç–æ–≥–æ –ø–æ —Å–º–µ—Ç–µ:</b> ${total.toLocaleString('ru-RU')} ‚ÇΩ</div>`;
}

function estimateToPlainText(){
  const wrap = document.getElementById('estimate-body');
  if (!wrap) return '';
  const rows = [];
  const table = wrap.querySelector('table');
  if (table){
    const trs = table.querySelectorAll('tbody tr');
    trs.forEach(tr => {
      const name = tr.children[0]?.textContent.trim() || '';
      const qty  = tr.children[1]?.textContent.trim() || '';
      const price= tr.children[2]?.textContent.trim() || '';
      const sum  = tr.children[3]?.textContent.trim() || '';
      rows.push(`${name} ‚Äî ${qty} —à—Ç. √ó ${price} = ${sum}`);
    });
    const totalLine = wrap.querySelector('.total-line')?.textContent.replace(/\s+/g,' ').trim() || '';
    const address = document.getElementById('estimate-address')?.value?.trim();
    return (rows.join('\n') + (rows.length ? `\n${totalLine}` : '') + (address ? `\n–ê–¥—Ä–µ—Å: ${address}` : '')).trim();
  }
  return '';
}

function attachCopyHandler(){
  const btn = document.getElementById('btn-copy-estimate');
  if (!btn) return;
  btn.addEventListener('click', async () => {
    if (!document.querySelector('#estimate-body table')) { if (typeof buildEstimate === 'function') buildEstimate(); }
    const text = estimateToPlainText();
    if (!text) { btn.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'; setTimeout(()=>btn.textContent='–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 1200); return; }
    try {
      await navigator.clipboard.writeText(text);
      const old = btn.textContent; btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ'; setTimeout(()=>btn.textContent = old, 1500);
    } catch(e){
      const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta);
      ta.select(); try { document.execCommand('copy'); } catch(e2){} document.body.removeChild(ta);
      const old = btn.textContent; btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ'; setTimeout(()=>btn.textContent = old, 1500);
    }
  });
}

function attachEstimateHandler(){
  const btn = document.getElementById('btn-estimate');
  if (!btn) return;
  btn.addEventListener('click', () => {
    buildEstimate();
    const est = document.getElementById('estimate');
    if (est){ est.classList.remove('hidden'); est.scrollIntoView({behavior:'smooth', block:'start'}); }
  });
}

function attachPdfHandler(){
  const btn = document.getElementById('btn-estimate-pdf');
  if (!btn) return;
  btn.addEventListener('click', () => {
    if (!document.querySelector('#estimate-body table')) { if (typeof buildEstimate === 'function') buildEstimate(); }
    const wrap = document.getElementById('estimate-body');
    const address = document.getElementById('estimate-address')?.value?.trim() || '';
    if (!wrap || !wrap.querySelector('table')) { btn.textContent='–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'; setTimeout(()=>btn.textContent='–°–∫–∞—á–∞—Ç—å PDF', 1200); return; }
    const inner = wrap.innerHTML.replace(/<\/script>/ig, '<\\/script>'); // escape closing script
    const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–°–º–µ—Ç–∞</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 24px; }
        h1 { margin: 0 0 10px; font-size: 20px; }
        .meta { font-size: 12px; opacity: .8; margin-bottom: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 6px; }
        th, td { border-bottom: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f5f5f5; }
        .total { text-align: right; font-weight: 700; margin-top: 10px; }
      </style></head><body>
      <h1>–°–º–µ—Ç–∞</h1>
      <div class="meta">–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}</div>
      ${address ? `<div class="meta"><b>–ê–¥—Ä–µ—Å:</b> ${address}</div>` : ''}
      ${inner}
      <script>window.print();<\/script>
      </body></html>`;
    const w = window.open('', '_blank');
    if (!w) return;
    w.document.open(); w.document.write(html); w.document.close();
  });
}

try { attachCopyHandler(); attachEstimateHandler(); attachPdfHandler(); } catch(e){}
</script>

</body>
</html>
